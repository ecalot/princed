#!/bin/bash

NO_COLOR="\033[0m"
LGREEN="\033[01;32m"
LRED="\033[01;31m"

SDONE="[$LGREEN Done$NO_COLOR ]"
SOK="[$LGREEN  OK $NO_COLOR ]"
SFAIL="[$LRED Fail$NO_COLOR ]"

numberstart=50

#initializes output files
number=$numberstart
echo -n "Generating header and xml files            "
cp -f result/data.h result/data.h.bak 2>/dev/null >/dev/null
echo -e "/* data.h: Auto generated file header for resources */\n">result/data.h
cat xml/gen1.xml > xml/resources.xml

#process and add all definitions to the xml and h files
for definition in def/*.def 
do
	definition=`echo $definition|sed -e "s/def\/\(.*\)\.def/\1/g"`
	bin/makeindex def/$definition.def index/$definition.index
	echo "  <item value=\"$number\" path=\"$definition.index\">$definition</item>" >> xml/resources.xml
	echo "#define $definition $number" >> result/data.h
	number=`expr $number + 1`
done
cat xml/gen2.xml >> xml/resources.xml
echo -e "\n#define DATA_START_ITEMS $numberstart\n#define DATA_END_ITEMS $number" >> result/data.h
echo -e "$SOK"

#generate the dat file using the proceced indexes and the xml file
echo -n "Generating dat file                        "
bin/pr --import=index --force --backup=bak --resource=xml/resources.xml result 2>/dev/null >/dev/null
result=$?

if [ $result == 0 ] ; then
	echo -e "$SOK"
else
	echo -e "$SFAIL"
fi
